{% extends 'webapp/base.html' %}

{% block 'title' %}
    –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞
{% endblock %}

{% block 'body' %}
<div class="row">
    <h4 class="fw-bold py-3 mb-1"><span class="text-muted fw-light">–ë–∞–ª–∞–Ω—Å /</span> –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–ø–ª–∞—Ç—ã</h4>

    <div class="col-xl-6 my-form-border">
        <div class="card mb-4 my-form-area">
            <ul class="list-group list-group-flush">
                <li class="list-group-item">üí≥ <strong>–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã:</strong>
                    {% if pay_method == 'to_card' %}
                        <code>–ü–µ—Ä–µ–≤–æ–¥ –Ω–∞ –∫–∞—Ä—Ç—É</code>
                    {% endif %}
                </li>
                <li class="list-group-item">üíµ <strong>–°—É–º–º–∞:</strong> <code>{{ amount }}</code> ‚ÇΩ</li>
                <li class="list-group-item">üßæ <strong>–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è —Å—á–µ—Ç–∞:</strong> <code>{{ created_at }}</code></li>
                <li class="list-group-item">üîπ <strong>–°—Ç–∞—Ç—É—Å:</strong> <code>{{ status }}</code></li>
                <li class="list-group-item">ü¶ß <strong>–Æ–∑–µ—Ä –±–æ—Ç–∞:</strong> <code>{{ bot_user.tlg_id }} | <a href="https://t.me/{{ bot_user.tlg_username }}">@{{ bot_user.tlg_username }}</a></code></li>
            </ul>
        </div>
    </div>

    <div class="col-xl-6 my-form-border">
        <div class="card mb-1 my-form-area">
            <form id="interestsForm" action="{% url 'webapp:check_payment' %}" method="post" enctype="multipart/form-data">
                {% csrf_token %}
                <input type="hidden" name="tg_msg_id" value="{{ tg_msg_id }}">
                <input type="hidden" name="accept_pay_flag" id="acceptPayFlag">
                {% if messages %}
                    <ul class="messages">
                        {% for message in messages %}
                            <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
                        {% endfor %}
                    </ul>
                {% endif %}

                <input type="hidden" name="bill_hash" value="{{ bill_hash }}">
                <div class="row">
                    <div class="col-12 my-form-border">
                        <div class="card my-form-area">
                            <h5 class="card-header">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞</h5>
                            <div class="card-body demo-vertical-spacing demo-only-element">
                                <small class="text-light fw-semibold"><b>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ</b> –∏–ª–∏ <b>–æ—Ç–∫–ª–æ–Ω–∏—Ç–µ –ø–ª–∞—Ç—ë–∂</b>, –Ω–∞–∂–∞–≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –∫–Ω–æ–ø–∫–∏. –í—ã —Ç–∞–∫–∂–µ –º–æ–∂–µ—Ç–µ —É–∫–∞–∑–∞—Ç—å –∫–∞–∫–æ–π-–ª–∏–±–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π. –û–Ω –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∫–∞–∫ –≤ —Å–ª—É—á–∞–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞, —Ç–∞–∫ –∏ –≤ —Å–ª—É—á–∞–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.</small>
                                <div class="input-group">
                                    <textarea class="my-filling-fields" name="bill_comment" id="bill_comment" cols="30" rows="5" placeholder="–£–∫–∞–∂–∏—Ç–µ –∫–∞–∫–æ–π-–ª–∏–±–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π. –≠—Ç–æ –ø–æ–ª–µ –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º."></textarea>
                                </div>
                                <div class="input-group">
                                    <button class="btn rounded-pill btn-info btn-outline-primary my-btn-clr" type="submit" id="confirmPaymentButton">‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
                                    <button class="btn rounded-pill btn-info btn-outline-primary my-btn-clr" type="submit" id="declinePaymentButton">‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏ –æ—Ç —Ç–µ–ª–µ–≥–∏-->
<script>
  var tgObject = window.Telegram.WebApp;
  tgObject.enableClosingConfirmation()  // –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ WebApp
</script>

<!--—Å–∫—Ä–∏–ø—Ç –¥–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –∫–Ω–æ–ø–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã –ø—Ä–∏ –∫–ª–∏–∫–µ –ø–æ –Ω–µ–π-->
<script>
  let confirmPaymentButton = document.getElementById('confirmPaymentButton');
  let declinePaymentButton = document.getElementById('declinePaymentButton');
  let acceptPayFlag = document.getElementById('acceptPayFlag');
  let applicationForm = document.getElementById('interestsForm');
  confirmPaymentButton.addEventListener('click', function() {
      declinePaymentButton.setAttribute("disabled", "disabled");
      confirmPaymentButton.setAttribute("disabled", "disabled");
      confirmPaymentButton.textContent = '‚åõÔ∏è –û—Ç–ø—Ä–∞–≤–ª—è—é –¥–∞–Ω–Ω—ã–µ...';
      acceptPayFlag.setAttribute("value", "1");
      applicationForm.submit();
  });
  declinePaymentButton.addEventListener('click', function() {
      declinePaymentButton.setAttribute("disabled", "disabled");
      confirmPaymentButton.setAttribute("disabled", "disabled");
      declinePaymentButton.textContent = '‚åõÔ∏è –û—Ç–ø—Ä–∞–≤–ª—è—é –¥–∞–Ω–Ω—ã–µ...';
      acceptPayFlag.setAttribute("value", "0");
      applicationForm.submit();
  });
</script>

{% endblock %}